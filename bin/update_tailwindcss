#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'open-uri'
require 'json'

# File paths
root_dir = Pathname.new(File.expand_path('..', __dir__))
headwind_path = root_dir.join('lib/tag_options/property_handler/tailwind_css.rb')

# Get Headwind's latest configuration
json = URI.open('https://raw.githubusercontent.com/heybourn/headwind/master/package.json') do |page|
  JSON.parse(page.read)
end

# Parse out Headwind's latest sort order
sort_order = json.dig('contributes', 'configuration')&.first&.dig('properties', 'headwind.defaultSortOrder', 'default')
raise 'unable to read headwind json' unless sort_order

# Build the latest sort order string
indent = '       '
new_sort_order = "SORT_ORDER = %w[\n"
line = indent
sort_order.each do |item|
  if line.size + item.size + 1 > 120
    new_sort_order += "#{line}\n"
    line = indent
  else
    line += " #{item}"
  end
end
new_sort_order += "\n" unless new_sort_order.end_with?("\n")
new_sort_order += '      ]'

# Replace the existing sort order with the latest
contents = File.read(headwind_path)
File.write(
  headwind_path,
  contents.gsub(
    /SORT_ORDER = %w\[[^\]]*\]/,
    new_sort_order
  )
)
